<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ONG • Collecte & Visualisation de données</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --primary: #6e8efb;
            --accent: #a777e3;
            --bg: #0f172a;
            --card: #0b1328;
            --muted: #94a3b8;
            --ring: 0 0 0 3px rgba(110, 142, 251, .35);
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%
        }

        body {
            margin: 0;
            background: linear-gradient(160deg, #0b1226 0%, #0e172f 60%, #0b1022 100%) fixed;
            color: #e2e8f0;
            font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"
        }

        a {
            color: inherit
        }

        .container {
            max-width: 1200px;
            margin-inline: auto;
            padding: 0 20px
        }

        header {
            position: sticky;
            top: 0;
            z-index: 50;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            box-shadow: 0 6px 20px rgba(0, 0, 0, .25)
        }

        nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 0
        }

        .logo {
            font-weight: 800;
            letter-spacing: .5px
        }

        .nav-links {
            display: flex;
            gap: 22px
        }

        .nav-links a {
            opacity: .9;
            text-decoration: none
        }

        .nav-links a:hover {
            opacity: 1
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: .5rem;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border: none;
            color: white;
            padding: .75rem 1rem;
            border-radius: 14px;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 8px 24px rgba(110, 142, 251, .35);
            transition: .2s
        }

        .btn:hover {
            transform: translateY(-1px)
        }

        .btn.secondary {
            background: transparent;
            border: 1px solid #334155;
            color: #cbd5e1;
            box-shadow: none
        }

        .hero {
            padding: 54px 0 28px;
            border-bottom: 1px solid #1f2937;
            background: radial-gradient(1200px 500px at 70% -50%, rgba(110, 142, 251, .25), transparent 70%)
        }

        .hero h1 {
            font-size: clamp(1.8rem, 2.2vw, 2.6rem);
            margin: .25rem 0 10px
        }

        .hero p {
            color: #cbd5e1;
            max-width: 820px
        }

        .grid {
            display: grid;
            gap: 18px
        }

        .grid.cols-3 {
            grid-template-columns: repeat(3, 1fr)
        }

        .grid.cols-2 {
            grid-template-columns: repeat(2, 1fr)
        }

        @media(max-width:980px) {
            .grid.cols-3 {
                grid-template-columns: 1fr 1fr
            }
        }

        @media(max-width:720px) {

            .grid.cols-2,
            .grid.cols-3 {
                grid-template-columns: 1fr
            }
        }

        .card {
            background: linear-gradient(180deg, rgba(255, 255, 255, .02), rgba(255, 255, 255, .00));
            border: 1px solid #1f2a44;
            padding: 18px;
            border-radius: 18px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, .25)
        }

        .kpis {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 14px
        }

        @media(max-width:900px) {
            .kpis {
                grid-template-columns: repeat(2, 1fr)
            }
        }

        .kpi {
            background: linear-gradient(135deg, rgba(110, 142, 251, .1), rgba(167, 119, 227, .08));
            border: 1px solid #1f2a44;
            border-radius: 18px;
            padding: 14px
        }

        .kpi .label {
            font-size: .85rem;
            color: var(--muted)
        }

        .kpi .value {
            font-size: 1.6rem;
            font-weight: 800;
            margin-top: 6px
        }

        h2.section {
            margin: 22px 0 12px;
            font-size: 1.1rem;
            color: #cbd5e1;
            letter-spacing: .4px
        }

        form .row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px
        }

        @media(max-width:900px) {
            form .row {
                grid-template-columns: 1fr
            }
        }

        label {
            font-size: .85rem;
            color: #cbd5e1;
            margin-bottom: 6px;
            display: block
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 12px 12px;
            border-radius: 12px;
            border: 1px solid #243146;
            background: #0b142b;
            color: #e5e7eb;
            outline: none
        }

        input:focus,
        select:focus,
        textarea:focus {
            box-shadow: var(--ring);
            border-color: #3b82f6
        }

        table {
            width: 100%;
            border-collapse: collapse
        }

        th,
        td {
            padding: 10px;
            border-bottom: 1px solid #1e293b;
            text-align: left
        }

        th {
            font-size: .85rem;
            color: #a5b4fc;
            font-weight: 600
        }

        tr:hover td {
            background: rgba(148, 163, 184, .06)
        }

        .toolbar {
            display: flex;
            gap: 8px;
            flex-wrap: wrap
        }

        .muted {
            color: #94a3b8
        }

        footer {
            margin: 32px 0 50px;
            text-align: center;
            color: #94a3b8
        }

        .tag {
            display: inline-flex;
            align-items: center;
            padding: .25rem .6rem;
            border: 1px solid #314269;
            border-radius: 999px;
            font-size: .75rem;
            color: #cbd5e1
        }
    </style>
</head>

<body>
    <header>
        <div class="container">
            <nav>
                <div class="logo">VONIN • ONG DataHub</div>
                <div class="nav-links">
                    <a href="#collecte">Collecte</a>
                    <a href="#tableau">Tableau de bord</a>
                    <a href="#donnees">Données</a>
                    <a href="#aide">Aide</a>
                </div>
                <button id="btnExport" class="btn secondary" title="Exporter les données en CSV">Exporter CSV</button>
            </nav>
        </div>
    </header>

    <section class="hero container">
        <span class="tag">Démo – 100% Frontend (LocalStorage)</span>
        <h1>Collecte et visualisation des données pour ONG</h1>
        <p>Une application web élégante en un seul fichier pour <strong>enregistrer</strong> des
            bénéficiaires/activités, <strong>analyser</strong> les indicateurs et <strong>visualiser</strong> les
            tendances. Les données sont stockées localement (navigateur) et peuvent être exportées/importées.
        </p>
        <div style="margin-top:14px" class="toolbar">
            <button class="btn" id="btnImport">Importer JSON</button>
            <input type="file" id="fileInput" accept=".json" hidden>
            <button class="btn secondary" id="btnReset">Réinitialiser</button>
        </div>
    </section>

    <main class="container" style="padding:24px 0 8px">
        <h2 id="collecte" class="section">Formulaire de collecte</h2>
        <div class="card">
            <form id="formEntry">
                <div class="row">
                    <div>
                        <label>Date de l'activité</label>
                        <input type="date" id="date" required />
                    </div>
                    <div>
                        <label>Programme</label>
                        <select id="programme" required>
                            <option value="">— Choisir —</option>
                            <option>Santé</option>
                            <option>Éducation</option>
                            <option>Agriculture</option>
                            <option>Protection</option>
                            <option>Autre</option>
                        </select>
                    </div>
                    <div>
                        <label>Type d'activité</label>
                        <select id="type" required>
                            <option value="">— Choisir —</option>
                            <option>Formation</option>
                            <option>Sensibilisation</option>
                            <option>Aide matérielle</option>
                            <option>Suivi</option>
                        </select>
                    </div>
                </div>
                <div class="row" style="margin-top:12px">
                    <div>
                        <label>Localité</label>
                        <input id="localite" placeholder="Ville / Village" required />
                    </div>
                    <div>
                        <label>Sexe</label>
                        <select id="sexe" required>
                            <option value="">— Choisir —</option>
                            <option>F</option>
                            <option>M</option>
                        </select>
                    </div>
                    <div>
                        <label>Âge</label>
                        <input type="number" id="age" min="0" max="120" placeholder="Années" required />
                    </div>
                </div>
                <div class="row" style="margin-top:12px">
                    <div>
                        <label>Bénéficiaires (nbre)</label>
                        <input type="number" id="nb" min="1" placeholder="Ex: 30" required />
                    </div>
                    <div>
                        <label>Coût / Montant (optionnel)</label>
                        <input type="number" id="montant" min="0" step="0.01" placeholder="Ex: 250000" />
                    </div>
                    <div>
                        <label>Observation</label>
                        <input id="obs" placeholder="Remarque" />
                    </div>
                </div>
                <div class="toolbar" style="margin-top:14px">
                    <button class="btn" type="submit">Ajouter l'enregistrement</button>
                    <button class="btn secondary" type="button" id="btnDemo">Générer des données de démo</button>
                </div>
            </form>
        </div>

        <h2 id="tableau" class="section">Tableau de bord</h2>
        <div class="kpis" id="kpiWrap">
            <div class="kpi">
                <div class="label">Total bénéficiaires</div>
                <div class="value" id="kpiBenef">0</div>
            </div>
            <div class="kpi">
                <div class="label">Nb d'activités</div>
                <div class="value" id="kpiActs">0</div>
            </div>
            <div class="kpi">
                <div class="label">Part Femmes</div>
                <div class="value" id="kpiFem">0%</div>
            </div>
            <div class="kpi">
                <div class="label">Montant total</div>
                <div class="value" id="kpiMontant">0</div>
            </div>
        </div>

        <div class="grid cols-3" style="margin-top:14px">
            <div class="card"><canvas id="chartByProg" height="150"></canvas></div>
            <div class="card"><canvas id="chartSexe" height="150"></canvas></div>
            <div class="card"><canvas id="chartTime" height="150"></canvas></div>
        </div>

        <h2 id="donnees" class="section">Données collectées</h2>
        <div class="card">
            <div class="toolbar" style="margin-bottom:10px">
                <input id="q" placeholder="Filtrer (programme, localité, type)…" style="max-width:340px" />
                <select id="fProgramme">
                    <option value="">Programme (tous)</option>
                    <option>Santé</option>
                    <option>Éducation</option>
                    <option>Agriculture</option>
                    <option>Protection</option>
                    <option>Autre</option>
                </select>
                <select id="fType">
                    <option value="">Type (tous)</option>
                    <option>Formation</option>
                    <option>Sensibilisation</option>
                    <option>Aide matérielle</option>
                    <option>Suivi</option>
                </select>
                <input type="month" id="fMonth" />
            </div>
            <div style="overflow:auto">
                <table id="tbl">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Programme</th>
                            <th>Type</th>
                            <th>Localité</th>
                            <th>Sexe</th>
                            <th>Âge</th>
                            <th>Bénéf.</th>
                            <th>Montant</th>
                            <th>Obs.</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <h2 id="aide" class="section">Aide & Intégrations</h2>
        <div class="card">
            <p class="muted">Cette démo sauvegarde dans <strong>localStorage</strong>. En production, connectez le
                bouton d'envoi à une API/BDD (ex: Supabase/PostgreSQL, Google Sheets, Django, Node/Express, R/Shiny). Je
                peux fournir la version reliée à Supabase ou à Google Sheets.</p>
        </div>
    </main>

    <footer class="container">
        Fait avec ❤️ pour les ONG — VONIN
    </footer>

    <script>
        // --------- Utilitaires ---------
        const LS_KEY = 'ong_datahub_v1';
        const $ = (sel, root = document) => root.querySelector(sel);
        const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));

        const currency = n => new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'XOF' }).format(Number(n || 0));

        function loadData() {
            try { return JSON.parse(localStorage.getItem(LS_KEY) || '[]'); } catch { return [] }
        }
        function saveData(rows) { localStorage.setItem(LS_KEY, JSON.stringify(rows)); }

        function uid() { return Math.random().toString(36).slice(2, 9); }

        // --------- État ---------
        let rows = loadData();

        // --------- Formulaire ---------
        $('#formEntry').addEventListener('submit', (e) => {
            e.preventDefault();
            const r = {
                id: uid(),
                date: $('#date').value || new Date().toISOString().slice(0, 10),
                programme: $('#programme').value,
                type: $('#type').value,
                localite: $('#localite').value.trim(),
                sexe: $('#sexe').value,
                age: Number($('#age').value || 0),
                nb: Number($('#nb').value || 0),
                montant: Number($('#montant').value || 0),
                obs: $('#obs').value.trim()
            };
            rows.push(r); saveData(rows); render(); e.target.reset();
        });

        $('#btnDemo').addEventListener('click', () => {
            const demo = [
                { date: '2025-07-02', programme: 'Santé', type: 'Sensibilisation', localite: 'Man', sexe: 'F', age: 27, nb: 48, montant: 120000, obs: 'Vaccination' },
                { date: '2025-07-05', programme: 'Éducation', type: 'Formation', localite: 'Daloa', sexe: 'M', age: 31, nb: 30, montant: 80000, obs: '' },
                { date: '2025-07-10', programme: 'Agriculture', type: 'Suivi', localite: 'Bangolo', sexe: 'M', age: 43, nb: 22, montant: 0, obs: '' },
                { date: '2025-07-14', programme: 'Protection', type: 'Aide matérielle', localite: 'Danané', sexe: 'F', age: 24, nb: 60, montant: 300000, obs: 'Kits' },
                { date: '2025-07-20', programme: 'Santé', type: 'Formation', localite: 'Man', sexe: 'F', age: 29, nb: 35, montant: 95000, obs: '' },
                { date: '2025-08-01', programme: 'Éducation', type: 'Sensibilisation', localite: 'Abidjan', sexe: 'F', age: 21, nb: 140, montant: 0, obs: 'Rentrée' },
            ];
            rows = rows.concat(demo.map(d => ({ ...d, id: uid() }))); saveData(rows); render();
        });

        $('#btnReset').addEventListener('click', () => {
            if (confirm('Effacer toutes les données locales ?')) { rows = []; saveData(rows); render(); }
        });

        // --------- Filtres & Recherche ---------
        const filters = { q: '', programme: '', type: '', yyyymm: '' };
        $('#q').addEventListener('input', e => { filters.q = e.target.value.toLowerCase(); renderTable(); renderKpisAndCharts(); });
        $('#fProgramme').addEventListener('change', e => { filters.programme = e.target.value; render(); });
        $('#fType').addEventListener('change', e => { filters.type = e.target.value; render(); });
        $('#fMonth').addEventListener('change', e => { filters.yyyymm = e.target.value; render(); });

        function applyFilters(list) {
            return list.filter(r =>
                (!filters.programme || r.programme === filters.programme) &&
                (!filters.type || r.type === filters.type) &&
                (!filters.yyyymm || (r.date || '').slice(0, 7) === filters.yyyymm) &&
                (!filters.q || `${r.programme} ${r.type} ${r.localite}`.toLowerCase().includes(filters.q))
            );
        }

        // --------- Tableau ---------
        function renderTable() {
            const tbody = $('#tbl tbody');
            tbody.innerHTML = '';
            const list = applyFilters(rows).sort((a, b) => a.date.localeCompare(b.date));
            for (const r of list) {
                const tr = document.createElement('tr');
                tr.innerHTML = `
          <td>${r.date || ''}</td>
          <td>${r.programme}</td>
          <td>${r.type}</td>
          <td>${r.localite}</td>
          <td>${r.sexe}</td>
          <td>${r.age}</td>
          <td>${r.nb}</td>
          <td>${r.montant ? currency(r.montant) : ''}</td>
          <td>${r.obs || ''}</td>
          <td><button class="btn secondary" data-id="${r.id}">Suppr.</button></td>`;
                tbody.appendChild(tr);
            }
            // suppression
            tbody.addEventListener('click', (e) => {
                const id = e.target?.dataset?.id; if (!id) return;
                rows = rows.filter(x => x.id !== id); saveData(rows); render();
            }, { once: true });
        }

        // --------- KPI & Graphiques ---------
        let chartByProg, chartSexe, chartTime;

        function sum(list, fn) { return list.reduce((a, b) => a + fn(b), 0); }

        function renderKpisAndCharts() {
            const list = applyFilters(rows);
            $('#kpiActs').textContent = list.length;
            $('#kpiBenef').textContent = sum(list, r => r.nb);
            const femmes = sum(list.filter(r => r.sexe === 'F'), r => r.nb);
            const total = Math.max(1, sum(list, r => r.nb));
            $('#kpiFem').textContent = Math.round(femmes * 100 / total) + "%";
            $('#kpiMontant').textContent = currency(sum(list, r => r.montant || 0));

            const agg = (by, value) => {
                const map = new Map();
                for (const r of list) {
                    const k = by(r); map.set(k, (map.get(k) || 0) + value(r));
                }
                return { labels: [...map.keys()], data: [...map.values()] };
            };

            const byProg = agg(r => r.programme, r => r.nb);
            const bySexe = agg(r => r.sexe || 'N/A', r => r.nb);
            const byMonth = agg(r => (r.date || '').slice(0, 7), r => r.nb);

            const mk = (ctx, type, labels, data, title) => new Chart(ctx, {
                type, data: { labels, datasets: [{ label: title, data }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { ticks: { color: '#cbd5e1' } }, y: { ticks: { color: '#cbd5e1' } } } }
            });

            chartByProg?.destroy(); chartSexe?.destroy(); chartTime?.destroy();
            chartByProg = mk($('#chartByProg'), 'bar', byProg.labels, byProg.data, 'Bénéficiaires par programme');
            chartSexe = mk($('#chartSexe'), 'doughnut', bySexe.labels, bySexe.data, 'Répartition par sexe');
            chartTime = mk($('#chartTime'), 'line', byMonth.labels, byMonth.data, 'Tendance mensuelle');
        }

        // --------- Export / Import ---------
        function download(filename, text) {
            const a = document.createElement('a');
            a.href = URL.createObjectURL(new Blob([text], { type: 'text/plain' }));
            a.download = filename; a.click(); URL.revokeObjectURL(a.href);
        }

        $('#btnExport').addEventListener('click', () => {
            // Export en CSV minimal
            const list = rows;
            const cols = ['date', 'programme', 'type', 'localite', 'sexe', 'age', 'nb', 'montant', 'obs'];
            const csv = [cols.join(',')].concat(list.map(r => cols.map(c => `"${(r[c] ?? '').toString().replaceAll('"', '""')}"`).join(','))).join('\n');
            download('donnees_ong.csv', csv);
        });

        $('#btnImport').addEventListener('click', () => $('#fileInput').click());
        $('#fileInput').addEventListener('change', (e) => {
            const file = e.target.files?.[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = evt => { try { rows = JSON.parse(evt.target.result); saveData(rows); render(); } catch { alert('Fichier invalide. Attendu: JSON créé par cette app.'); } };
            reader.readAsText(file);
        });

        // --------- Init ---------
        function render() { renderTable(); renderKpisAndCharts(); }
        render();
    </script>
</body>

</html>